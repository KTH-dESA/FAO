workdir: "Morocco model"

SCENARIOS = ['Reference', 'Desalination','Irrigation Intensification']
# W_RATE = [0, 0.3, 0.5, 0.7]
# PV_RATE = [0, 0.3, 0.5, 0.7]
# GRID_RATE = [0, -0.3, -0.5, -0.7]
# SCENARIOS = ["Reference"]
CLIMATE = ['Trend', 'Climate Change']
W_RATE = [0]
PV_RATE = [0]
GRID_RATE = [0]

rule input_data:
    input: expand("../Morocco dashboard/data/{scenario}/{climate}/W{w_rate}_PV{pv_rate}_Grid{grid_rate}/lcoe.gz", \
                  scenario=SCENARIOS, climate=CLIMATE, w_rate=W_RATE, \
                  pv_rate=PV_RATE, grid_rate=GRID_RATE)

rule copy_data:
    input: "Data/WEAP Results/SoussMassa Results - {scenario} - {climate}.xlsx"
    params: scenario="{scenario}", climate="{climate}"
    output: "Data/Ordered results/{scenario}/{climate}/data.xlsx"
    # shell: "python script.py {params.x} {output}"
    run:
        import os
        from shutil import copyfile
        scenario = str(params.scenario)
        climate = str(params.climate)
        
        if not os.path.exists(os.path.join("Data","Ordered results")):
            os.mkdir(os.path.join("Data","Ordered results"))
        if not os.path.exists(os.path.join("Data", "Ordered results", scenario)):
            os.mkdir(os.path.join("Data", "Ordered results", scenario))   
        if not os.path.exists(os.path.join("Data", "Ordered results", scenario, climate)):
            os.mkdir(os.path.join("Data", "Ordered results", scenario, climate))
    
        copyfile(str(input), str(output))

rule softlinking:
    input: "Data/Ordered results/{scenario}/{climate}/data.xlsx" 
    params: scenario="{scenario}", climate="{climate}"
    output: "Data/Processed results/{scenario}/{climate}/demand_data.gz"
    shell: 'python softlinking.py "{params.scenario}" "{params.climate}"'
    
rule energy_model:
    input: "Data/Processed results/{scenario}/{climate}/demand_data.gz" 
    params: scenario="{scenario}", climate="{climate}"
    output: "../Morocco dashboard/data/{scenario}/{climate}/results.gz"
    shell: 'python energy_model.py "{params.scenario}" "{params.climate}"'
    
rule lcoe_model:
    input: "../Morocco dashboard/data/{scenario}/{climate}/results.gz" 
    params: scenario="{scenario}", climate="{climate}", w_rate="{w_rate}", pv_rate="{pv_rate}", grid_rate="{grid_rate}"
    output: "../Morocco dashboard/data/{scenario}/{climate}/W{w_rate}_PV{pv_rate}_Grid{grid_rate}/lcoe.gz"
    shell: 'python lcoe_model.py "{params.scenario}" "{params.climate}" "{params.w_rate}" "{params.pv_rate}" "{params.grid_rate}"'    
